<!DOCTYPE html>
<html lang="en">
<head>
      <title>Intrusion Report (Forums) &middot; Glowstone</title>
    <meta charset="utf-8"/>
    <meta name="theme-color" content="#e8970b">
    <meta name="generator" content="Pelican"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:site_name" content="Glowstone">
    <meta property="og:title" content="Intrusion Report (Forums)">
    <meta property="og:description" content="This is a post to notify everyone of a possible intrusion relating to the forum. I have provided a full report in an effort to be as transparent as possible.">
    <meta name="twitter:description" content="This is a post to notify everyone of a possible intrusion relating to the forum. I have provided a full report in an effort to be as transparent as possible.">
    <meta name="description" content="This is a post to notify everyone of a possible intrusion relating to the forum. I have provided a full report in an effort to be as transparent as possible.">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@GlowstoneMC">
    <meta name="twitter:creator" content="@GlowstoneMC">
    <meta property="og:image" content="https://glowstone.net/theme/images/glowstone-logo-colour.png">
    <meta itemprop="image" content="https://glowstone.net/theme/images/glowstone-logo-colour.png">
    <meta name="twitter:image" content="https://glowstone.net/theme/images/glowstone-logo-colour.png">
    <link href="https://glowstone.net/feeds/atom/news"
          type="application/atom+xml" rel="alternate" title="Glowstone Full Atom Feed"/>
    <link href="https://glowstone.net/feeds/rss/news"
          type="application/rss+xml" rel="alternate" title="Glowstone RSS Feed"/>



    <meta name="tags" content="blog" />

    <link rel="stylesheet" href="/theme/css/bulma.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
    <link rel="stylesheet" href="/theme/css/custom.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/baguettebox.js@1.11.1/dist/baguetteBox.min.css" integrity="sha256-cLMYWYYutHkt+KpNqjg7NVkYSQ+E2VbrXsEvOqU7mL0=" crossorigin="anonymous">
<link rel="stylesheet" href="/theme/css/news_view.css">
</head>

<body>

<header id="banner" class="hero is-primary">
        <div class="hero-head">
        <div class="container">
            <nav class="navbar is-transparent" role="navigation" aria-label="brand bar">
                <div class="navbar-brand">
                    <a class="navbar-item" href="/" title="Home">
                        <img src="/theme/images/glowstone-text.png" alt="glowstone" width="112" height="28">
                    </a>
                </div>

                <div class="navbar-end">
                    <span class="navbar-item">
                        <a class="button is-light is-outlined" href="/feeds" title="Feeds">
                            <span class="icon">
                                <i class="fa fa-feed"></i>
                            </span>
                        </a>
                    </span>
                </div>
            </nav>
        </div>
    </div>
    <div class="hero-foot">
    <div class="container">
        <nav class="tabs is-boxed">
            <ul>
                <li>
                    <a href="/">Home</a>
                </li>
                <li class="is-active">
                    <a href="/news">News</a>
                </li>
                <li>
                    <a href="/community">Community</a>
                </li>
            </ul>

            <ul class="is-right">
                <li>
                    <a href="/docs">Docs</a>
                </li>
                <li>
                    <a href="/#downloads">Downloads</a>
                </li>
            </ul>
        </nav>
    </div>
    </div>
</header>
<nav class="nav has-shadow" style="padding-left: 1%">
  <div class="container">
    <div class="nav-left">
      <span class="nav-item has-text-weight-bold">Latest news</span>
      <a class="nav-item is-tab" href="/news/glowstone-202180/">Glowstone 2021.8.0</a>
      <a class="nav-item is-tab" href="/news/glowstone-202170/">Glowstone 2021.7.0</a>
      <a class="nav-item is-tab" href="/news/glowstone-201870/">Glowstone 2018.7.0</a>
    </div>
  </div>
</nav>
<section class="section">
  <div class="container">
    <p class="field">
      <a class="button is-outlined is-primary" href="/news">
        <span class="icon">
          <i class="fa fa-chevron-left"></i>
        </span>
        <span>Back to news</span>
      </a>
    </p>
    <br>
    <div class="box news-view content gallery">
      <div class="news-title-section">
        <div class="is-pulled-right" style="display: block;">
          <img src="http://cdn.libravatar.org/avatar/3be902453ce267f9605e871c2cfee795" class="box image is-32x32" title="Posted by gdude2002" />
        </div>
        <a href="/news/intrusion-report-forums/" rel="bookmark" title="Permalink to Intrusion Report (Forums)">
          <h1 class="news-title" style="display: inline">
            Intrusion Report (Forums)
          </h1>
        </a>
        <br>
        <span class="news-subtitle" style="display: inline" class="title is-3">
          <time datetime="2017-07-28T09:03:00+00:00"> Fri 28 July 2017 </time>
        </span>
      </div>
      <hr>
      <p>This is a post to notify everyone of a possible intrusion relating to the forum. I have provided a full report in an effort to be as transparent as possible.</p>
<h2>Report</h2>
<h3>Tuesday, 25th July 2017</h3>
<p>Momo noticed that the forums were down. I was asleep at the time, and did not get the message until the morning - it was late at night.</p>
<h3>Wednesday, 26th July 2017</h3>
<p>I got Momo's message, and investigated the problem. I assumed that Redis was down, so I restarted it and updated and restarted the forums, and everything appeared to be working just fine. I noticed that the plugins we had installed were removed, and so I reinstalled them. No configuration data was lost. I also noticed that a couple of posts I had made a day or two before that were missing.</p>
<h3>Thursday, 27th July 2017</h3>
<p>I noticed that a Nextcloud install on a different VM (my personal install) was using the same database server as a memory cache, despite being configured not to. I reconfigured Nextcloud and removed all of its cached data from the database. Nextcloud did not touch any actual NodeBB data, so that wasn't the cause of the issue.</p>
<p>At this point, we realised that data going back around a month and a half had been lost. Fearing further data loss, I set up some cron tasks to force Redis to save its data and save a backup every hour. I checked the Redis logs and there was nothing abnormal in them, so I assumed the problem was with NodeBB and continued investigating with Momo.</p>
<p>After reading over NodeBB logs, events and errors, we found nothing of interest.</p>
<h3>Friday, 28th July 2017</h3>
<p>At around 4AM BST, Momo became available again and continued his investigation. He discovered two things:</p>
<ul>
<li>Redis was accessible (without a password) from outside of the network</li>
<li>Redis was failing to save any data due to an error, thus disabling the forums</li>
</ul>
<p>At around 8:30AM BST, I came online and restarted my investigation.</p>
<p>Due to an issue with Proxmox (the hypervisor I use to manage containers and VMs and keep things compartmentalised), it turned out that the firewall I had configured was not doing its job - instead of dropping all disallowed traffic as it was meant to, it was simply allowing everything. I fixed this problem by setting up a firewall directly on the storage container and this secured it from the outside.</p>
<p>I noticed that Redis was attempting to save data to <code>/var/spool/cron</code>, which is not its usual location. It did not have permission to write there - which is why it was failing to save data. Upon further investigation, I noticed that it was able to overwrite the crontab I had set up earlier - and had done so with the entire contents of the database. At this point, I took down both Redis and NodeBB so that I could fix things up.</p>
<p>I wiped all of the cron storage directories and reinstalled cron. I double-checked the Redis configuration and found nothing unusual, so I restarted that as well. It started up correctly and did not attempt to write to <code>/var/spool/cron</code> again.</p>
<p>I used a GUI tool to inspect the Redis data, and I noticed that the data I had removed previously (from Nextcloud) was still present. I removed it again, and I noticed an extra key that I hadn't seen earlier: It was a randomized key, containing a crontab entry. This crontab was configured to download a shell script from an IP address and execute it.</p>
<p>I grabbed a copy of the script myself and took a look at it, and it simply downloaded a cryptocurrency miner and ran it. Upon investigation, it was clear that this crontab had never been run, and that the attack was supposed to play out as follows:</p>
<ul>
<li>Search for compromisable Redis servers</li>
<li>Add a key with a crontab entry to run the script</li>
<li>Use the <code>CONFIG SET</code> command to overwrite the crontab with the database</li>
<li>Wait for the cryptocurrency miner to start</li>
</ul>
<p>The cron daemon I'm using performs very strict syntax checks and did not run the crontab - as soon as it realised there were invalid "entries" in the file, it errored out.</p>
<p>I removed the key from the database and made sure the forum was running correctly.</p>
<h3>Exposure</h3>
<p>While there was absolutely no evidence that this attack targetted NodeBB or even Glowstone specifically, precautions should always be taken. As NodeBB stores its entire database in Redis, all of the data therein was exposed. It's impossible to say what the attackers may have taken - if anything - but as always, users should take all of the necessary precautions.</p>
<p>NodeBB stores passwords using <code>bcrypt</code>. This is an industry standard and currently considered very secure, but we still advise users to change their passwords - both on the forums, and on any accounts they own elsewhere that may be using the same password as their forum account. Note that any other data provided during registration and profile modification will have been accessible as well - for example, email addresses.</p>
<p>I have revoked all the user tokens from GitHub OAuth, and reset the client secret, to protect users' GitHub accounts.</p>
<hr>
<p>I'd like to apologise for this intrusion personally - it definitely shouldn't have happened, and while I'm amazed that it did, it is my responsibility. Please don't attack or bug any of the other staff members - they don't have direct access to any of this stuff.</p>
<p>As far as I am aware, everything is now secure and in working order, but I'm going to continue monitoring and testing throughout the day. Feel free to contact me if you have any questions.</p>
    </div>
  </div>
</section>

<section class="hero is-info" id="sponsors" style="background-color: #2b87d3;">
    <div class="hero-body">
        <div class="container">
            <div class="columns is-vcentered">
                <div class="column is-4">
                    <a href="https://aternos.org/" title="Aternos - Minecraft servers. Free. Forever.">
                        <img src="/theme/images/sponsors/aternos.png" />
                    </a>
                </div>
                <div class="column is-8">
                    <p class="title has-text-weight-light">We are proudly sponsored by <strong class="has-text-weight-bold">Aternos</strong></p>
                    <p class="subtitle">Minecraft Servers. Free. Forever.</p>
                </div>
            </div>
        </div>
    </div>
</section>
<footer class="footer">
    <div class="container">
        <div class="content has-text-centered">
            <p>
                Made with <span class="has-text-danger">&hearts;</span> by the <a href="https://github.com/GlowstoneMC/" rel="noopener">Glowstone project</a>.
            </p>
            <p>
                Glowstone is licensed under the <a href="https://github.com/GlowstoneMC/Glowstone/blob/dev/LICENSE" rel="noopener">MIT license</a>,
                while this site is licensed under the <a href="https://github.com/GlowstoneMC/glowstonemc.github.io/blob/main/LICENSE" rel="noopener">Artistic License 2.0</a>.
                If you're thinking of contributing, please read <a href="/cla">our CLA</a>.
            </p>
            <p>
                Glowstone would not be possible without <a target="_blank"
                                                           href="https://github.com/GlowstoneMC/Glowstone#credits" rel="noopener">these folks</a> &mdash; thanks for your time and passion!
            </p>
        </div>
    </div>
</footer>
<script src="https://cdn.jsdelivr.net/npm/baguettebox.js@1.11.1/dist/baguetteBox.min.js" integrity="sha256-ULQV01VS9LCI2ePpLsmka+W0mawFpEA0rtxnezUj4A4=" crossorigin="anonymous"></script>
<script type="text/javascript">
    baguetteBox.run(".gallery", {
        animation: "fadeIn",
        noScrollbars: true
    })
</script>
</body>
</html>